"use strict";define("render/bi/events.json",[],function(){return{SERVER_SIDE_RENDERING_DEBUG:{eventId:4,reportType:"event",endpoint:"bt",src:29,sampleRatio:1,params:{phaseName:"phaseName",errorType:"errorType",error_message:"error_message",statusid:"statusid"}}}}),define("render/bi/events",["render/bi/events.json","loggingUtils"],function(e,r){return r.logger.register("render","event",e),e}),define("render",["lodash","reactDOM","zepto","coreUtils","utils","core","render/bi/events","wixUrlParser","loggingUtils","experiment","animations","tweenEngine","TweenMax","TimelineMax","ScrollToPlugin","DrawSVGPlugin"],function(e,r,n,i,t,a,s,o,d,w,c,l,u,p){function g(e,r){window.clientSideRender?r&&r():requirejs(["warmup"],function(r){e(r)})}function S(e){n("#SITE_CONTAINER").attr("data-santa-render-status",e)}function f(e,r){var n=r.query,i=(e[n.configName||"fullFunctionality"]||e.fullFunctionality).getConfig();if(!n.dsOrigin)throw new Error("You must define dsOrigin parameter in order to use the documentServices - please speak to html-server team for a key");return i.origin=n.dsOrigin,i}function v(r,n,i){var a=e(i).keys().pull("masterPage").value();return e.mapValues(i,function(e,i){return n&&window.pagesData&&window.pagesData[i]?e:t.dataFixer.fix(e,a.slice(),r.requestModel,r.currentUrl,r.urlFormatModel,"site"===r.viewMode,r.rendererModel)})}function m(e,r,n,i){d.logger.reportBI(e,s.SERVER_SIDE_RENDERING_DEBUG,{phaseName:"diverge_reporting_failed",statusid:r||0,errorType:n||"noErrorType",error_message:i||"noErrorMessage"})}function D(r,n,i,a,s){t.ajaxLibrary.ajax({type:"POST",url:"https://jy75p2avi1.execute-api.us-west-2.amazonaws.com/prod/logDiffs",dataType:"json",headers:{"x-api-key":"NrelGcqXZH9pIBYc3zjA77SIpiBKUkp643H7P41F"},success:function(n,i,t){(n.errorType||n.errorMessage)&&m(r,e.get(t,"status",0),n.errorType,n.errorMessage)},data:{vsi:s,santaVersion:a,url:window.location.href,ssrDiverge:{clientMarkup:n,serverMarkup:i}},error:function(n,i,t){m(r,e.get(n,"status",0),i,t)}})}function y(n,i,t,s,o){g(function(e){e.willRender(i)}),window.clientSideRender&&window.santaRenderingError&&window.parent&&window.parent.postMessage({santaRenderingError:window.santaRenderingError.errorInfo},"*");var d=window.document.getElementById("SITE_CONTAINER").children[0];s.onBeforeLayout=function(){var e=window.document.getElementById("SITE_CONTAINER").children[0],r=e.innerHTML;window.sssr.clientSantaVersion=e.getAttribute("data-santa-version"),g(function(n){window.sssr.success=d===e,S(window.sssr.success?"SUCCESS":"DIVERGE"),window.sssr.clientSideRender={sinceInitialTimestamp:Date.now()-window.wixBiSession.initialTimestamp,performanceNow:R()},window.parent&&(window.sssr.success?window.parent.postMessage("sssrSuccess","*"):(window.sssr.clientSantaVersion!==window.sssr.serverSantaVersion&&(r=window.sssr.clientSantaVersion,window.sssr.serverMarkup=window.sssr.serverSantaVersion),window.sssr.clientMarkup=r,window.sssr.serverMarkup=window.sssr.serverMarkup||d.outerHTML,window.parent.postMessage({sssrFail:{clientMarkup:window.sssr.clientMarkup,serverMarkup:window.sssr.serverMarkup}},"*"),D(i,window.sssr.clientMarkup,window.sssr.serverMarkup,window.sssr.clientSantaVersion,i.wixBiSession.viewerSessionId))),n.didRender(i,window.sssr.success)},function(){S("CLIENT")})},a.renderer.renderSite(i,t,s,function(i){window.rendered?window.rendered.forceUpdate():(window.rendered=r.render(i,window.document.getElementById("SITE_CONTAINER")),window.onpopstate=window.rendered.onPopState,window.onhashchange=window.rendered.onHashChange,window.parent!==window&&requirejs(["santaPreview"],function(e){window.rendered.registerAspectToEvent("siteReady",function(){o&&o(window.rendered),window.documentServices&&(window.parent.postMessage("documentServicesLoaded","*"),window.createSantaPreview=e)})}),n.qaAutomation&&(e.set(window,"testApi.domSelectors",n.qaAutomation.getDomSelectors(n.react,n.reactDOM)),window.testApi.domSelectors.setSearchRoot(window.rendered),e.set(window,"testApi.isReady",!0)))})}function I(r,n,s){var o={};i.urlUtils.isQueryParamOn(s.currentUrl,"isSantaEditor")&&(o=e.assign(o,{componentViewMode:"editor"})),s.rendererModel.previewMode&&(o=e.assign(o,{isSocialInteractionAllowed:!1,isPlayingAllowed:!1})),s.renderFlags=e.assign({},s.renderFlags,o);var d=new t.FullSiteData(s);d.updateScreenSize();var w=l.create(u,p);d.animations=c.create(w);var g=a.SiteDataAPI.createSiteDataAPIAndDal(d,n),S=g.siteData,f=g.siteDataAPI;return{fullSiteData:d,displayedSiteData:S,siteDataWrapper:g,viewerPrivateServices:{pointers:g.pointers,displayedDAL:g.displayedDal,siteDataAPI:f},isServerSideRender:S.isClientAfterSSR(),siteModel:s,siteDataAPI:f}}function E(r,n){e.forOwn(n,function(e){r.createDisplayedPage(e.structure.id)})}function M(r,n,i,a,s){var d=I(r,n,i),c=r.documentServices;try{c&&e.isUndefined(window.karmaIntegration)&&w.isOpen("sv_fullstory",i)&&t.integrations.fullStory.start(i)}catch(e){}if(c)d.siteDataWrapper.dataLoadedRegistrar=d.siteDataAPI.registerDataLoadedCallback.bind(d.siteDataAPI),window.documentServices=new c.Site(f(c.configs,d.siteModel.currentUrl),d.siteDataWrapper,e.partial(v,d.siteModel,d.isServerSideRender),e.partial(y,r,d.displayedSiteData,d.viewerPrivateServices,a),e.partial(E,d.siteDataAPI)),e.set(window,"testApi.documentServices",window.documentServices);else{var l=d.siteDataWrapper.fullPagesData.pagesData;if(l&&(v(d.siteModel,d.isServerSideRender,l),l.masterPage)){d.siteDataAPI.createDisplayedPage("masterPage");var u=o.parseUrl(d.displayedSiteData,d.displayedSiteData.currentUrl.full);d.displayedSiteData.setRootNavigationInfo(u),d.siteDataAPI.createDisplayedPage(u.pageId)}y(r,d.displayedSiteData,d.viewerPrivateServices,a,s)}}var R=Object.freeze("undefined"!=typeof window&&window.performance&&window.performance.now?window.performance.now.bind(window.performance):Date.now.bind(Date));return{clientSide:M}});
//# sourceMappingURL=render.min.js.map