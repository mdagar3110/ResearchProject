"use strict";define("wixCodeInit/utils/urlBuilder",[],function(){function e(){for(var e=arguments[0],t=1;t<arguments.length;++t)e=e.replace(/\/$/,"")+"/"+arguments[t].replace(/^\//,"");return e}function t(e){return/^https?:\/\/localhost\/?$/.test(e)}function n(e){return/^https?:\/\/s3.amazonaws.com\/integration-tests-statics\/SNAPSHOT\/santa?$/.test(e)}function i(e){return/^\d+\.\d+\.\d+$/.test(e)}function r(e,t){var n=e.lastIndexOf("/");return i(t)?e.substring(0,n+1)+t:e}function o(e,i){var o=e.serviceTopology,a=t(e.santaBase)||n(e.santaBase)?o.scriptsLocationMap.santa:e.santaBase;return a=r(a,i),/(.*\/services\/)?(.*)/.exec(a)[2]}function a(t,n,i){var r="//"+n.instanceId+".",a=t.serviceTopology.wixCloudBaseDomain,s="node_modules/santa-wix-code/"+(i.useWixCodeFallback?"fallback.html":"index.html");return r+e(a,"_partials",o(t,i.runtimeSource),s)}function s(e){return Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")}function d(e,t,n){var i=a(e,t,n=n||{}),r=!!e.publicModel,o={compId:"wixCode_"+t.appDefinitionId,deviceType:n.isMobileView?"mobile":"desktop",viewMode:r?"site":e.renderFlags.componentViewMode||"preview",locale:e.rendererModel.languageCode,wixCodeBase:e.santaBase+"/node_modules/santa-wix-code"};return n.sdkSource&&(o.sdkSource=n.sdkSource),n.applications&&(o.applications=JSON.stringify(n.applications)),n.ReactSource&&(o.ReactSource=n.ReactSource),i+"?"+s(o)}return{buildUrl:d}}),define("wixCodeInit/utils/messageHolder",[],function(){function e(){var e=[],t=null;return{sendOrHoldMessage:function(n){t?t(n):e.push(n)},setMessageTarget:function(n){for(t=n;e.length>0;)t(e.shift())}}}return{get:e}}),define("wixCodeInit/utils/iFrameUtils",[],function(){function e(e,t){var n=window.document.createElement("iframe");return n.style.cssText="position: fixed; left: 0; right: 0; top: 0; bottom: 0; width: 100%; height: 100%; background: transparent;",n.src=e,n.setAttribute("data-app-id",t.applicationId),n.setAttribute("data-app-definition-id",t.appDefinitionId),n}function t(e,t){return t.source===e.contentWindow}return{getIFrameForApp:e,isIFrameEvent:t}}),define("wixCodeInit/utils/appsUtils",["lodash"],function(e){function t(t,n){var i;return e.forEach(n,function(e){var n=t.getDynamicPageData(e);n&&(i=n)}),i}function n(n,i,r){if(n){var o=t(n,r);if(o){var a=o.routerData,s=o.routerDefinition;if(a&&s)if("wix-code"===s.appDefinitionId)e.forEach(r,function(t){e.forEach(i,function(e){e.id===t&&(e.routerData=a)})});else{var d=e.find(i,{id:s.appDefinitionId});d&&(d.routerData=a)}}}}function i(t){var n={displayName:"siteextension"};return e(t).reject(n).map(function(t){return e.assign({type:m.APPLICATION},t)}).value()}function r(t){return!!e.get(t,["wixCodeModel","appData","codeAppId"])}function o(t,n,i,o,a){if(r(o.rendererModel)&&e.find(t,n)){var s=o.isPlatformAppOnPage("masterPage","wixCode");e.forEach(i,function(t){var n=o.isPlatformAppOnPage(t,"wixCode"),i=o.getDataByQuery(t),r=e.get(i,"isPopup");n&&a.push({id:t,type:r?m.POPUP:m.PAGE,displayName:o.getPageTitle(t)}),!r&&s&&a.push({id:t,type:m.MASTER_PAGE})})}}function a(t,r,a){t=e.without(t,"masterPage");var s={displayName:"siteextension"},d=i(a);return o(a,s,t,r,d),n(r,d,t),d}function s(){for(var e=arguments[0],t=1;t<arguments.length;++t)e=e.replace(/\/$/,"")+"/"+arguments[t].replace(/^\//,"");return e}function d(e,t,n){var i=s(e.scriptsDomainUrl,"services",t);return n?s(i,n):e.scriptsLocationMap[t]}function u(t,n,i){if(e.get(t,"port")&&e.get(t,"path")&&e.get(t,"id")){i=e.endsWith(i,"/")?i.slice(0,-1):i;var r,o=e.template("<%= santaBase %><%= port %>/<%= path %>");r=/^(http(s)?:)?\/\//.test(t.path)?t.path:o("80"===t.port?{santaBase:i,port:"",path:t.path}:{santaBase:i,port:":"+t.port,path:t.path}),n.push({type:m.APPLICATION,id:t.id,url:r,displayName:t.id})}}function p(t,n,i,o,a){r(a)&&e.find(t,{type:"siteextension"})&&!e.find(n,{id:"dataBinding"})&&n.push({type:m.APPLICATION,id:"dataBinding",url:s(d(i,"dbsm-viewer-app",o.dataBinding),"/app.js"),displayName:"Data Binding"})}function c(t,n){return e(t).filter(function(t){return r(n)&&"siteextension"===t.type||e.get(t,"platformApp.viewerUrl")}).map(function(t){var n={id:t.appDefinitionId,displayName:t.type,appInnerId:t.applicationId},i=e.get(t,"platformApp.viewerUrl");return i&&(n.url=i),n}).value()}function l(e){var t=c(e.clientSpecMap,e.rendererModel),n=w(e.viewerPlatformAppSources);return u(n,t,e.santaBase),p(e.clientSpecMap,t,e.serviceTopology,n,e.rendererModel),t}function f(t){var n=l(t);return e.filter(i(n),"url")}function g(t,n,i){return a(n,i,l({clientSpecMap:t,viewerPlatformAppSources:e.get(i,["currentUrl","query","viewerPlatformAppSources"]),serviceTopology:i.serviceTopology,santaBase:i.santaBase,rendererModel:i.rendererModel}))}function w(t){return e(t||"").split(",").invokeMap("split",/:(.+)/).fromPairs().value()}function M(t,n,i){return e.reject(g(t,n,i),{type:m.APPLICATION})}var m={POPUP:"Popup",PAGE:"Page",MASTER_PAGE:"masterPage",APPLICATION:"Application"};return{getApplications:g,getUserCodeDefinitions:M,getAppsBaseInfo:f}}),define("wixCodeInit/utils/widgetsPreLoader",["wixCodeInit/utils/appsUtils"],function(e){function t(e,t,n,i){if(a())return p.push([e,t,n,i]),void requirejs(["utils","widgets","wixCode"],o);var r=i(s);r.currentUrl=s.urlUtils.parseUrl(e);var c=s.wixUrlParser.parseUrl(r,e),l=c&&c.pageId;if(l){var f=t(d,r,l),g=u.wixCodeWidgetService.getWixCodeSpec(r.getClientSpecMap());n(u.messageBuilder.getExtendedMessage(f,r.rendererModel.wixCodeModel||{},g,r))}}function n(n,i,r){t(i,function(t,i,r){var o=e.getApplications(n.rendererModel.clientSpecMap,[r],i),a=n.routers||{configMap:{}};return t.messageBuilder.loadWidgetsMessage(o,a.configMap,[r])},r,function(e){return new e.FullSiteData(n,function(){})})}function i(n,i,r){t(i,function(t,i,r){var o=e.getUserCodeDefinitions(n.rendererModel.clientSpecMap,[r],i);return t.messageBuilder.loadUserCodesMessage(o,[r])},r,function(e){return new e.FullSiteData(n,function(){})})}function r(e,n,i){t(n,function(e,t,n){var i={};return i[n]=e.widgetService.getControllersToInit(t,n),e.messageBuilder.initWidgetsMessage(i)},i,function(){return e})}function o(e,n,i){if(a()){s=e,d=n,u=i;for(var r=0;r<p.length;r++)t.apply(null,p[r]);p.length=0}}function a(){return!s||!d||!u}var s=null,d=null,u=null,p=[];return{asyncGetPreLoadMessage:n,asyncGetPreLoadUserCodeMessage:i,asyncGetPreInitMessage:r,registerDeps:o}}),define("wixCodeInit/utils/specMapUtils",[],function(){function e(e){for(var n in e)if(e.hasOwnProperty(n)&&e[n].type===t)return e[n]}var t="siteextension";return{getAppSpec:e}}),define("wixCodeInit/api/wixCodeAppApi",["lodash","wixCodeInit/utils/urlBuilder","wixCodeInit/utils/messageHolder","wixCodeInit/utils/iFrameUtils","wixCodeInit/utils/widgetsPreLoader","wixCodeInit/utils/specMapUtils"],function(e,t,n,i,r,o){function a(e){return"WIX_CODE"===e.intent&&"wix_code_iframe_loaded"===e.type}function s(e){return"WIX_CODE_SITE_API"===e.intent&&"reportBI"===e.type}function d(e){function t(){var t=window.document.body;t.insertBefore(e,t.firstChild)}"loading"!==window.document.readyState?t():window.document.addEventListener("DOMContentLoaded",function(){t()})}function u(t){var n=t.rendererModel.clientSpecMap.toJS?t.rendererModel.clientSpecMap.toJS():t.rendererModel.clientSpecMap;return!!t.rendererModel.wixCodeModel&&e.some(n,{type:"siteextension"})}function p(){function e(e,t){if(i.isIFrameEvent(e,t)){if(a(t.data)&&C.setMessageTarget(function(t){e.contentWindow.postMessage(t,"*")}),s(t.data)&&!I.length&&"undefined"!=typeof window){var n=t.data.reportDef,r=t.data.params;n.errorCode?window.wixBiSession.sendError(n,r.p1,r.p2,r.p3,r.p4):window.wixBiSession.sendBI(n.endpoint,n.eventId,n.src,r)}I.forEach(function(e){e(t.data)})}}function p(){return P}function c(n,r,a){if(P)console.warn("Wix code is already initiated");else if(u(n)){var s=o.getAppSpec(r),p=t.buildUrl(n,s,a),c=i.getIFrameForApp(p,s),l=e.bind(null,c);window.addEventListener("message",l,!1),d(c),P=!0}}function l(e){I.push(e)}function f(e){x.push(e)}function g(e){var t=e;return x.forEach(function(e){t=e(t)}),t}function w(e){e&&C.sendOrHoldMessage(g(e))}function M(e,t){!A&&u(e)&&r.asyncGetPreLoadMessage(e,t,function(e){y&&!A&&(A=e,C.sendOrHoldMessage(A))})}function m(e,t){!S&&u(e)&&r.asyncGetPreLoadUserCodeMessage(e,t,function(e){S||(S=e,C.sendOrHoldMessage(S))})}function v(e,t){!h&&u(e)&&r.asyncGetPreInitMessage(e,t,function(e){h||(h=e,C.sendOrHoldMessage(h))})}var I=[],x=[],C=n.get(),P=!1,y=!0,A=null,S=null,h=null;return{init:c,sendMessage:w,registerMessageHandler:l,registerMessageModifier:f,preLoadWidgets:M,preLoadUserCode:m,preInitWidgets:v,isAppInitiated:p}}return{getApi:p}}),define("wixCodeInit/api/initMainR",["lodash","wixCodeInit/utils/specMapUtils","wixCodeInit/utils/appsUtils"],function(e,t,n){function i(i,r,o,a,s){function d(e){return t.getAppSpec(e)||M.applications.length}function u(e){return new e.FullSiteData(r,function(){})}function p(t,n){return!!n&&!e.find(t.pageList.pages,{pageId:n}).pageJsonFileName}function c(e){var t=u(e);t.currentUrl=e.urlUtils.parseUrl(s);var n=e.wixUrlParser.parseUrl(t,s);return n&&n.pageId}function l(e,t,n){t&&p(t,c(n))||(i.init(r,e,M),d(e)&&(i.preLoadUserCode(r,s),!!r.publicModel&&i.preLoadWidgets(r,s)))}s=s||window.document.location.href;var f=e.trimEnd(r.serviceTopology.scriptsLocationMap["js-wixcode-sdk"],"/")+"/lib/wix.min.js",g=window.navigator&&window.navigator.userAgent&&/bot|google|phantom|crawler|spider|robot|crawling|^Mozilla\/4\.0$/i.test(window.navigator.userAgent),w="true"===a.getParameterByName("useWixCodeFallback")||!window.Worker||g,M={isMobileView:o,sdkSource:a.getParameterByName("sdkSource")||f,runtimeSource:a.getParameterByName("WixCodeRuntimeSource"),ReactSource:a.getParameterByName("ReactSource"),useWixCodeFallback:w},m=a.getParameterByName("viewerPlatformAppSources");M.applications=n.getAppsBaseInfo({rendererModel:r.rendererModel,clientSpecMap:r.rendererModel.clientSpecMap,serviceTopology:r.serviceTopology,viewerPlatformAppSources:m,santaBase:r.santaBase}),function(){if(requirejs.defined("utils")){var e=requirejs("utils");l(r.rendererModel.clientSpecMap,r.publicModel,e)}else requirejs(["utils"],function(e){l(r.rendererModel.clientSpecMap,r.publicModel,e)})}()}return i}),define("wixCodeInit",["wixCodeInit/api/wixCodeAppApi","wixCodeInit/api/initMainR","wixCodeInit/utils/specMapUtils","wixCodeInit/utils/appsUtils","wixCodeInit/utils/widgetsPreLoader"],function(e,t,n,i,r){return{getAppApi:e.getApi,initMainR:t,specMapUtils:n,appsUtils:i,registerDeps:r.registerDeps}});
//# sourceMappingURL=wixCodeInit.min.js.map